FROM ubuntu:21.10
ENV TZ=Europe/Moscow
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
RUN apt update && apt upgrade -y && apt install default-jdk maven git wget -y
ENV CATALINA_HOME=/usr/local/tomcat
ENV PATH=$CATALINA_HOME/bin:$PATH
RUN mkdir -p "$CATALINA_HOME"
WORKDIR "$CATALINA_HOME"
RUN wget -O tomcat.tar.gz "https://mirror.linux-ia64.org/apache/tomcat/tomcat-9/v9.0.46/bin/apache-tomcat-9.0.46.tar.gz"
RUN tar -xf tomcat.tar.gz --strip-components=1 && rm -rf tomcat.tar.gz
RUN mkdir -p /home/user/ && cd /home/user/ && git clone https://github.com/Artur-/Solitaire.git
RUN cd /home/user/Solitaire/ && mvn package
RUN rm -rf $CATALINA_HOME/webapps/* && cp /home/user/Solitaire/target/*.war $CATALINA_HOME/webapps/solitaire.war
EXPOSE 8080
CMD ["catalina.sh", "run"]